<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>在Neza-D1上使用红外接收头做为输入 | xfdr0805·点滴记忆</title><meta name="author" content="xfdr0805"><meta name="copyright" content="xfdr0805"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="开发环境配置我的系统是在VirtualBox里跑的ubuntu18.04  a. 到平头哥官网下载riscv64-linux-x86_64-20210512.tar.gz交叉编译工具 b. sudo mkdir &amp;#x2F;opt&amp;#x2F;riscv64-linux-x86_64-20210512 c. tar -x"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://xfdr0805.gitee.io/pages/72f2/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '在Neza-D1上使用红外接收头做为输入',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-02-19 10:44:52'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.1.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='null'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">39</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">77</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><hr class="custom-hr"/></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="xfdr0805·点滴记忆"><span class="site-name">xfdr0805·点滴记忆</span></a></span><div id="menus"><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">在Neza-D1上使用红外接收头做为输入</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-08-31T03:35:34.000Z" title="发表于 2021-08-31 11:35:34">2021-08-31</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-02-19T02:44:52.560Z" title="更新于 2023-02-19 10:44:52">2023-02-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/">Linux</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>10分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="在Neza-D1上使用红外接收头做为输入"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h2 id="开发环境配置"><a href="#开发环境配置" class="headerlink" title="开发环境配置"></a>开发环境配置</h2><pre><code>我的系统是在VirtualBox里跑的ubuntu18.04 
a. 到平头哥官网下载riscv64-linux-x86_64-20210512.tar.gz交叉编译工具
b. sudo mkdir /opt/riscv64-linux-x86_64-20210512
c. tar -xzvf riscv64-linux-x86_64-20210512.tar.gz -C /opt/riscv64-linux-x86_64-20210512
d. vim /etc/bash.bashrc  添加PATH=&quot;$PATH:/opt/riscv64-linux-x86_64-20210512/bin&quot;
e. source /etc/bash.bashrc 使之生效
f. 终端输入riscv64-unknown-linux-gnu-gcc -v 出现版本信息说明外部工具链接配置好了
</code></pre>
<h3 id="D1芯片本身有硬件ir-tx-ir-rx-但在开发板上通过扩展IO引出的只有IR-RX，IR-TX用不了，被I2C2占用了，只有用IO来发射红外信号了"><a href="#D1芯片本身有硬件ir-tx-ir-rx-但在开发板上通过扩展IO引出的只有IR-RX，IR-TX用不了，被I2C2占用了，只有用IO来发射红外信号了" class="headerlink" title="D1芯片本身有硬件ir-tx ir-rx,但在开发板上通过扩展IO引出的只有IR-RX，IR-TX用不了，被I2C2占用了，只有用IO来发射红外信号了"></a>D1芯片本身有硬件ir-tx ir-rx,但在开发板上通过扩展IO引出的只有IR-RX，IR-TX用不了，被I2C2占用了，只有用IO来发射红外信号了</h3><ol>
<li><p>设备对配置<br>发射引脚，使用的是GPIO 需要在内核打开GPIO IR Bit Banging<br>ir_send {<br>compatible  &#x3D; “gpio-ir-tx”;<br>gpios &#x3D; &lt;&amp;pio 3 22 GPIO_ACTIVE_HIGH&gt;; &#x2F;* PD22 *&#x2F;<br>status &#x3D; “okay”;<br>};<br>接收引脚<br>&amp;s_cir0 {<br>pinctrl-names &#x3D; “default”, “sleep”;<br>pinctrl-0 &#x3D; &lt;&amp;s_cir0_pins_a&gt;;<br>pinctrl-1 &#x3D; &lt;&amp;s_cir0_pins_b&gt;;<br>linux,rc-map-name &#x3D; “rc-tbs-nec”;<br>status &#x3D; “okay”;<br>};<br>下边是注册过程<br>[    1.719737] i2c &#x2F;dev entries driver<br>[    1.723748] IR NEC protocol handler initialized<br>[    1.728825] IR RC5(x&#x2F;sz) protocol handler initialized<br>[    1.735217] rc rc0: GPIO IR Bit Banging Transmitter as &#x2F;devices&#x2F;platform&#x2F;soc@3000000&#x2F;soc@3000000:ir_send&#x2F;rc&#x2F;rc0<br>[    1.746722] rc rc0: lirc_dev: driver gpio-ir-tx registered at minor &#x3D; 0, no receiver, raw IR transmitter<br>[    1.758445] sunxi_ir_startup: get ir protocol failed<br>[    1.758467] (NULL device *): deviceless supply  not found, using dummy regulator<br>[    1.772394] Registered IR keymap rc_map_sunxi<br>[    1.777404] rc rc1: sunxi-ir as &#x2F;devices&#x2F;platform&#x2F;soc@3000000&#x2F;7040000.s_cir&#x2F;rc&#x2F;rc1<br>[    1.786130] rc rc1: lirc_dev: driver sunxi-rc-recv registered at minor &#x3D; 1, raw IR receiver, no transmitter<br>[    1.797263] input: sunxi-ir as &#x2F;devices&#x2F;platform&#x2F;soc@3000000&#x2F;7040000.s_cir&#x2F;rc&#x2F;rc1&#x2F;s_cir_rx</p>
</li>
<li><p>查看系统 &#x2F;dev下的设备<br> # ls &#x2F;dev&#x2F;lirc*<br> &#x2F;dev&#x2F;lirc1  &#x2F;dev&#x2F;lirc1  &#x2F;dev&#x2F;lircd</p>
</li>
<li><p>硬件电路请查看附件</p>
</li>
<li><p>此时查看&#x2F;dev&#x2F;input目录下,会有如下显示：</p>
<pre><code> # evtest 
 No device specified, trying to scan all of /dev/input/event*
 Available devices:
 /dev/input/event0:      sunxi-keyboard
 /dev/input/event1:      soc@3000000:rotary
 /dev/input/event2:      sunxi-ir
 /dev/input/event3:      audiocodec sunxi Audio Jack
 /dev/input/event4:      soc@3000000:gpio_keys
 /dev/input/event5:      ns2009_ts
</code></pre>
<p> 此时如果用evtest测试按键是没有任何反应的，因为keymap我们没有修改成自己用的遥控器，当然就不上报事件了，但不影响后续操作</p>
</li>
<li><p>我们可以用lirc里的工具去测试硬件是否OK,测试之前要先修改默认配置文件，不修改的话，同样没反应</p>
<pre><code> # vi /etc/lirc/lirc_options.conf 
 driver          = default
 device          = /dev/lric1
 修改这2行就可以，里边driver默认是uinput,device默认是auto
 再次测试就有反应了
 # mode2 -m -d /dev/lirc1
 Using driver default on device /dev/lirc1
 Trying device: /dev/lirc1
 Using device: /dev/lirc1
 Warning: Running as root.
    9043     4402      626      497      656      499
     624      499      656      499      624      499
     656      499      624      499      624      531
     624     1630      619     1624      655     1624
     624     1624      624     1634      646     1624
     624     1624      655     1624      593     1656
     624      501      654     1624      593      534
     652     1624      624      499      625     1624
     656      504      619      499      655     1625
     624      499      656     1625      593      531
     624     1633      648      498      624     1624
     624    40035  
    9060     2184      624   143451-pulse   483450-space
</code></pre>
<p> 从这结果上可以明显的看出这些数值代表脉冲宽度，单位是us </p>
</li>
<li><p>使用irrecod -f -d &#x2F;dev&#x2F;lirc1 –disable-namespace来录制配置文件<br> 录制完成后放到 &#x2F;etc&#x2F;lric&#x2F;liricd.conf.d&#x2F;下边<br> !注意，这里录制的结果不准确，需要借助上边的命令来获取每一个按键的值,这里只是借用一下配置文件的格式,里边的数字是右对齐<br> 示例：</p>
<pre><code> # Please take the time to finish this file as described in
 # https://sourceforge.net/p/lirc-remotes/wiki/Checklist/
 # and make it available to others by sending it to
 # &lt;lirc@bartelmus.de&gt;
 #
 # This config file was automatically generated
 # using lirc-0.10.1(default) on Thu Jan  1 01:37:06 1970
 # Command line used: -f -d /dev/lirc1 --disable-namespace
 # Kernel version (uname -r): 5.10.19
 #
 # Remote name (as of config file): elac
 # Brand of remote device, the thing you hold in your hand:
 # Remote device model nr:
 # Remote device info url:
 # Does remote device has a bundled capture device e. g., a
 #     usb dongle? :
 # For bundled USB devices: usb vendor id, product id
 #     and device string (use dmesg or lsusb):
 # Type of device controlled
 #     (TV, VCR, Audio, DVD, Satellite, Cable, HTPC, ...) :
 # Device(s) controlled by this remote:

 begin remote

 name  elac
 flags RAW_CODES|CONST_LENGTH
 eps            30
 aeps          100

 gap          108533

     begin raw_codes

         name Power
        9043     4403      623      531      593      531
         624      531      593      531      624      531
         593      531      624      531      593      536
         594     1680      592     1656      593     1656
         625     1655      593     1666      582     1656
         624     1656      593     1655      625      530
         593      534      621      530      593     1656
         624     1624      624      531      593      530
         624      531      595     1655      623     1655
         593     1656      593      530      624      531
         593     1664      616     1656      593     1656
         593

         name BT
        9041     4407      622      531      593      531
         593      562      593      531      593      531
         625      533      596      525      624      530
         593     1656      624     1656      593     1655
         593     1664      616     1655      593     1656
         593     1656      624     1658      591      530
         624     1656      593      531      624      531
         593      531      593      531      624     1661
         587      530      624     1656      593      531
         593     1687      593     1656      601     1648
         624     1656      593      531      593     1656
         624

     name Vol+
        9013     4437      592      530      593      562
         593      531      624      531      593      531
         594      565      589      530      593      531
         624     1656      593     1656      624     1665
         590     1651      591     1656      624     1655
         593     1656      593     1667      613      531
         593     1656      624     1656      593      531
         593      562      595      528      593     1656
         624      531      593     1656      624      531
         593      530      593     1659      621     1655
         593     1656      593      562      593     1656
         593
         
     name Vol-
        9044     4436      592      531      624      531
         593      533      622      530      593      531
         593      531      624      531      593      530
         624     1656      593     1661      595     1679
         593     1655      593     1656      624     1656
         593     1667      582     1659      620      530
         593     1656      624     1656      600      524
         624     1656      593      531      593      531
         624      531      593     1656      624      531
         598      530      620     1654      593      531
         624     1625      624     1656      593     1666
         614

     name Pre
        9048     4403      592      562      593      530
         593      562      593      530      593      531
         624      531      593      531      624      531
         593     1661      593     1680      592     1656
         593     1656      624     1656      603     1650
         588     1656      623     1656      593     1656
         624     1662      587     1655      593      531
         624      531      593      531      624     1656
         593      531      631      524      593      530
         593      562      593     1656      593     1656
         624     1663      586      530      624     1624
         624
         .
         .
         .
         .
         .
     end raw_codes

 end remote
</code></pre>
</li>
<li><p>接下来使用irw来验证刚才录制的是否正确<br> # irw<br> lircd-0.10.1[432]: Notice: accepted new client on &#x2F;var&#x2F;run&#x2F;lirc&#x2F;lircd<br> lircd-0.10.1[432]: Info: [lirc] protocol is enabled<br> 0000000000000001 00 Power elac<br> 0000000000000002 00 BT elac<br> 0000000000000003 00 Vol+ elac<br> 0000000000000004 00 Vol- elac<br> 0000000000000008 00 Ana1 elac<br> 000000000000000a 00 Opt1 elac<br> 000000000000000b 00 Opt2 elac</p>
</li>
<li><p>然后在&#x2F;etc&#x2F;lirc&#x2F;目录下创建lircrc配置文件或~&#x2F;.lircrc<br> 格式如下<br> begin<br>         prog &#x3D; irexec<br>         button &#x3D; Power<br>         repeat &#x3D; 0<br>         config &#x3D; echo “power”<br> end<br> begin<br>         prog &#x3D; irexec<br>         button &#x3D; Vol+<br>         repeat &#x3D; 1<br>         config &#x3D; amixer -M -c 0 sset ‘Headphone’,0 1%+ &gt; &#x2F;dev&#x2F;null<br> end<br> begin<br>         prog &#x3D; irexec<br>         button &#x3D; Vol-<br>         repeat &#x3D; 1<br>         config &#x3D; amixer -M -c 0 sset ‘Headphone’,0 1%- &gt; &#x2F;dev&#x2F;null<br> end<br> 保存</p>
</li>
<li><p>最后就是使用irexec来进行各种操作了,无需编程，到这里可以自由发挥了，想要集成到代码里也很简单，看下图</p>
<pre><code> # irexec 
 lircd-0.10.1[448]: Notice: accepted new client on /var/run/lirc/lircd
 lircd-0.10.1[448]: Info: [lirc] protocol is enabled
 
 volume up click
 Simple mixer control &#39;Headphone&#39;,0
 Capabilities: pvolume pvolume-joined pswitch
 Playback channels: Front Left - Front Right
 Limits: Playback 0 - 63
 Mono:
 Front Left: Playback 47 [54%] [-16.00dB] [on]
 Front Right: Playback 47 [54%] [-16.00dB] [on]

 volume down click
 Simple mixer control &#39;Headphone&#39;,0
 Capabilities: pvolume pvolume-joined pswitch
 Playback channels: Front Left - Front Right
 Limits: Playback 0 - 63
 Mono:
 Front Left: Playback 45 [50%] [-18.00dB] [on]
 Front Right: Playback 45 [50%] [-18.00dB] [on]
 
</code></pre>
</li>
<li><p>LIRC处理流程<br>        +——–+         +————-+                     +——–+<br>        |        |         | Linux input |                     | Appli- |<br> —&gt;—| kernel |—-&gt;—-| layer       |———-&gt;———-| cation |<br>        |        |         |             |  &#x2F;dev&#x2F;input&#x2F;eventX  |        |<br>        +——–+         +————-+                     +——–+<br><br><br>        +——–+         +————-+<br>        |        |         | Linux input |<br> —&gt;—| kernel |—-&gt;—-| layer       |<br>        |        |         |             |<br>        +——–+         +————-+<br>                                    |<br>                                    v<br>                                    |<br>                                    |                           +——–+<br>                            +————-+                     | Appli- |<br>                            |    lirc     |———-&gt;———-| cation |-+<br>                            |             |     lirc socket     |        | |<br>                            +————-+                     +——–+ |-+<br>                                                                    |        | |<br>                                                                    +——–+ |<br>                                                                    |        |<br>                                                                    +——–+<br><br>        +——–+         +————-+                     +——–+<br>        |        |         |             |                     | Appli- |<br> —&gt;—| kernel |—-&gt;—-|    lirc     |———-&gt;———-| cation |-+<br>        |        |         |             |     lirc socket     |        | |<br>        +——–+         +————-+                     +——–+ |-+<br>                                                                    |        | |<br>                                                                    +——–+ |<br>                                                                    |        |<br>                                                                    +——–+</p>
</li>
<li><p>通过socket使用lirc,不需要引入任何文件，可以方便的集成到代码里，就是上述第三种方式<br>struct sigaction act;<br>char buf[128];<br>struct sockaddr_un addr;<br>typedef struct<br>{<br>    char addr[32];<br>    char code[8];<br>    char type[16];<br>    char name[16];<br>} IRW_DATA;<br>IRW_DATA irw_data;<br>act.sa_handler &#x3D; sigusr1;<br>sigfillset(&amp;act.sa_mask);<br>act.sa_flags &#x3D; SA_RESTART; &#x2F;* don’t fiddle with EINTR *&#x2F;<br>sigaction(SIGUSR1, &amp;act, NULL);<br>addr.sun_family &#x3D; AF_UNIX;<br>strcpy(addr.sun_path, “&#x2F;var&#x2F;run&#x2F;lirc&#x2F;lircd”);<br>fd_lircd &#x3D; socket(AF_UNIX, SOCK_STREAM | SOCK_NONBLOCK, 0);<br>if (fd_lircd &#x3D;&#x3D; -1)<br>{<br>    printf(“Create socket failed\n”);<br>}<br>if (connect(fd_lircd, (struct sockaddr *)&amp;addr, sizeof(addr)) &#x3D;&#x3D; -1)<br>{<br>    printf(“Cannot connect to socket %s\n”, addr.sun_path);<br>}<br>while (1)<br>{<br>    &#x2F;&#x2F; lircd<br>    if (read(fd_lircd, buf, 128) &gt; 0)<br>    {<br>        LOG_D(“%s\n”, buf);<br>        char *p &#x3D; strtok(buf, “ “);<br>        int i &#x3D; 0;<br>        while (p)<br>        {<br>            &#x2F;&#x2F; LOG_D(“%s\n”, p);<br>            if (i &#x3D;&#x3D; 0)<br>                strcpy(irw_data.addr, p);<br>            else if (i &#x3D;&#x3D; 1)<br>                strcpy(irw_data.code, p);<br>            else if (i &#x3D;&#x3D; 2)<br>                strcpy(irw_data.type, p);<br>            else if (i &#x3D;&#x3D; 3)<br>                strcpy(irw_data.name, p);<br>            p &#x3D; strtok(NULL, “ “);<br>            i++;<br>        }<br>        LOG_D(“%s\n”, irw_data.type);<br>        switch ((uint8_t)strtol(irw_data.addr, NULL, 10))<br>        {<br>        case Vol_up:<br>            rotary_encoder_handler(&amp;u8g2, -1);<br>            break;<br>        case Vol_down:<br>            rotary_encoder_handler(&amp;u8g2, 1);<br>            break;<br>        case Play:<br>            rotary_encoder_button_handler(&amp;u8g2);<br>            break;<br>        case Bt:<br>            printf(“BT button\n”);<br>            break;<br>        }<br>    }<br>}</p>
</li>
<li><p>下边开始向外发射IR信号,发射就使用之前录制的配置文件</p>
<pre><code>irsend SEND_ONCE elac power
</code></pre>
</li>
</ol>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux/">Linux</a><a class="post-meta__tags" href="/tags/Neza-D1/">Neza-D1</a><a class="post-meta__tags" href="/tags/LIRIC/">LIRIC</a><a class="post-meta__tags" href="/tags/%E7%BA%A2%E5%A4%96%E9%81%A5%E6%8E%A7/">红外遥控</a></div><div class="post_share"></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">1.</span> <span class="toc-text">开发环境配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#D1%E8%8A%AF%E7%89%87%E6%9C%AC%E8%BA%AB%E6%9C%89%E7%A1%AC%E4%BB%B6ir-tx-ir-rx-%E4%BD%86%E5%9C%A8%E5%BC%80%E5%8F%91%E6%9D%BF%E4%B8%8A%E9%80%9A%E8%BF%87%E6%89%A9%E5%B1%95IO%E5%BC%95%E5%87%BA%E7%9A%84%E5%8F%AA%E6%9C%89IR-RX%EF%BC%8CIR-TX%E7%94%A8%E4%B8%8D%E4%BA%86%EF%BC%8C%E8%A2%ABI2C2%E5%8D%A0%E7%94%A8%E4%BA%86%EF%BC%8C%E5%8F%AA%E6%9C%89%E7%94%A8IO%E6%9D%A5%E5%8F%91%E5%B0%84%E7%BA%A2%E5%A4%96%E4%BF%A1%E5%8F%B7%E4%BA%86"><span class="toc-number">1.1.</span> <span class="toc-text">D1芯片本身有硬件ir-tx ir-rx,但在开发板上通过扩展IO引出的只有IR-RX，IR-TX用不了，被I2C2占用了，只有用IO来发射红外信号了</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By xfdr0805</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat-btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? '' : ''

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addModeChange('mermaid', runMermaid)

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'sEvINwaKzuTq1RkvCDLow0q3-gzGzoHsz',
      appKey: 'WUUWPWLohtQY1iG9euBjob62',
      avatar: 'monsterid',
      serverURLs: 'https://sevinwak.lc-cn-n1-shared.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>